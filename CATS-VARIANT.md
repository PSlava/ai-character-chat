# AI Bot Battle Arena — исследование на основе CATS и аналогов

## Оглавление
1. [Анализ CATS: Crash Arena Turbo Stars](#1-анализ-cats)
2. [Аналоги и конкуренты](#2-аналоги-и-конкуренты)
3. [AI-driven battle games — текущий рынок](#3-ai-driven-battle-games)
4. [Концепция веб-игры с AI](#4-концепция-веб-игры-с-ai)
5. [Техническая архитектура](#5-техническая-архитектура)
6. [Монетизация](#6-монетизация)
7. [MVP план](#7-mvp-план)

---

## 1. Анализ CATS

### Суть игры
CATS (ZeptoLab, 2017) — асинхронный авто-баттлер. Игроки собирают боевые машины из запчастей и выставляют их на автоматические бои. **Ноль управления во время боя** — весь скилл в фазе сборки. 100M+ скачиваний, #1 в 20 странах.

### Система сборки

Машина состоит из 4 типов компонентов:

| Компонент | Количество | Роль |
|-----------|-----------|------|
| **Шасси** (8 типов) | 1 | Форма, HP, слоты, физика (центр тяжести, клин, стабильность) |
| **Оружие** (13 типов) | 1-3 | Урон: melee (blade, drill, chainsaw) и ranged (rocket, laser, minigun) |
| **Колёса** (10 типов) | 2-3 | Подвижность, HP колеса, сцепление |
| **Гаджеты** (9 типов) | 0-1 | Утилита: booster, repulse, lifter, harpoon, shield, freeze |

Ключевое: **форма шасси определяет физику боя**. Клиновидный Pyramid заезжает под высокий Titan и переворачивает; круглый Boulder хаотично прыгает; низкий Sneaky трудно перевернуть.

### Механика боя
- **2D физика сбоку**, реалистичные столкновения (гравитация, импульс, трение)
- Машины стартуют с двух сторон, едут навстречу
- Оружие активируется автоматически (melee при контакте, ranged по таймеру)
- **Победа**: HP противника до 0 ИЛИ противник касается стены арены
- Арена сужается если бой затягивается (касание стены = мгновенная смерть)
- **Длительность боя: 3-15 секунд**

### Прогрессия (3 трека)
1. **Championship** — 24 стадии, брекеты по 15 игроков, медали за победы
2. **Quick Battles** — PvP лестница, серии побед (5 подряд = 1 корона), рейтинг
3. **Leagues** — 7 медальных тиров (Wood → Platinum), 3-дневные циклы

**Prestige**: после 24й стадии — сброс запчастей, сохранение навыков/рейтинга, открытие нового контента. До 250 престижей.

### Что делает игру аддиктивной

1. **Ультра-короткие бои** (3-15 сек) → "ещё один" всегда соблазнительно
2. **Голова > пальцы** — нет twitch-скилла, широкая аудитория
3. **Рандомность физики** — одинаковые билды дают слегка разные результаты
4. **Комбинаторика**: 8 шасси x 13 оружий x 10 колёс x 9 гаджетов = сотни билдов
5. **Асинхронный PvP** — не нужно ждать оппонента, поражения мотивируют итерацию (а не rage-quit)
6. **Визуальный спектакль** — машины переворачиваются, прыгают, взрываются
7. **Clash Royale таймеры** — лутбоксы на таймере создают привычку возвращаться

### Монетизация CATS
- **Лутбоксы с таймерами**: 4 слота, 2-6ч открытие. Гемы ускоряют
- **Hard currency (gems)**: $1.99-$99.99
- **Rewarded видео**: 30сек = -30мин от таймера
- **Доход (2025)**: ~$160K/мес (iOS $100K + Android $60K), ~140K скачиваний/мес

---

## 2. Аналоги и конкуренты

### 2.1 Авто-баттлеры (Configure → Watch)

| Игра | Фаза сборки | Фаза боя | Длительность |
|------|------------|----------|-------------|
| **CATS** | Drag-drop запчастей на шасси | 2-15с физика, полная автоматика | Секунды |
| **TFT** (Riot) | Покупка из магазина, позиционирование на гексах, аугменты | Юниты дерутся автоматически ~30с | Раунд в 30-40 мин матче |
| **Super Auto Pets** | Покупка питомцев/еды, порядок в линии | Лево-vs-право последовательные столкновения ~5-10с | Секунды |
| **Mechabellum** | Расстановка мехов на своей половине поля | Марш вперёд, последняя армия побеждает | 30-60с |
| **Backpack Battles** | Тетрис-инвентарь, соседство = комбо | Stamina-limited авто-атака ~10-15с | Секунды |
| **Gladiabots** | Визуальное программирование деревьев поведения | Отряды исполняют программу | Минуты |

**Рынок**: авто-баттлеры оцениваются в $1.5B к 2030 (CAGR 15.5%).

### 2.2 Игры с программированием ботов

| Игра | Механика | Платформа |
|------|---------|-----------|
| **Battlesnake** | HTTP API, змейка отвечает за 500мс, любой язык | Web |
| **Screeps** | Пишешь JavaScript для контроля юнитов, MMO | Web |
| **Robocode** | Программируешь танки на Java/C# | Desktop |
| **Gladiabots** | Визуальное программирование (без кода) | PC/Mobile |
| **CodinGame** | Бот-программирование с лигами (Wood → Legend) | Web |
| **Yare.io** | JavaScript RTS в браузере | Web |

### 2.3 AI/LLM батл-игры (новая категория)

| Игра | Механика | Статус |
|------|---------|--------|
| **TextBattle** | Одно предложение → Stable Diffusion генерит персонажа → LLM симулирует бой | Mobile/Web |
| **LLM Fighter** | Два LLM-агента дерутся через structured tool calls (5 скиллов) | Open source |
| **Prompt Wars** | Промпты конкурируют за контроль LLM (кто "заразит" модель своим текстом) | Web |
| **Tensor Trust** | Prompt injection атака/защита (1M+ игроков) | Web, research |
| **Digital Red Queen** | LLM эволюционирует assembly-программы для Core War | Research (Sakana AI) |

**Ключевой инсайт**: пересечение LLM-нарратива и авто-баттлер механик почти не исследовано в consumer-играх. TextBattle — ближайший, но без глубины билд-фазы.

---

## 3. AI-driven battle games

### Где AI добавляет ценность

| Применение | Тип AI | Задержка | Целесообразность |
|-----------|--------|---------|-----------------|
| **Нарратив/комментарий боя** | LLM (GPT/Claude) | 500мс-3с | Высокая — уникальный опыт |
| **Генерация персонажей/ботов** | LLM | 2-5с | Высокая — бесконечный контент |
| **Определение исхода боя** | Физика/правила | <1мс | Обязательно — детерминированность |
| **Советы по сборке** | LLM | 1-3с | Средняя — premium фича |
| **Тактическое поведение в бою** | Rule-based / мини-RL | <1мс | Средняя — для продвинутых |
| **Генерация арен/карт** | LLM + procedural | 1-5с | Низкая приоритетность |

### Как использовать LLM

1. **Пост-батл нарратив**: физика определяет бой → события (урон, переворот, взрыв) → LLM генерирует эпичный комментарий в реальном времени через SSE
2. **Персонажность ботов**: каждый бот имеет "характер" → LLM генерирует тaunts, victory lines, mid-battle quips (аналогично нашей системе персонажей)
3. **Генерация ботов-противников**: LLM придумывает тематического бота с историей, внешностью и стратегией
4. **Анализ боя**: "Почему я проиграл?" → LLM анализирует replay и даёт советы

---

## 4. Концепция веб-игры с AI

### Pitch
**"AI Bot Arena"** — веб-игра где игроки собирают боевых роботов, задают им поведение, и выставляют на автоматические бои с AI-комментариями. Каждый бот уникален благодаря AI-генерации.

### Два варианта концепции

#### Вариант A: Физика + AI нарратив (ближе к CATS)

**Фаза сборки:**
- Выбор шасси (6-8 типов с уникальной физикой)
- Установка оружия в слоты (melee/ranged, 10+ типов)
- Установка колёс (влияют на скорость/стабильность)
- Выбор гаджета (1 из 6-8 утилитарных эффектов)
- **AI-слой**: текстовое описание "характера" бота → LLM генерирует battle cry, taunts, personality

**Фаза боя:**
- 2D физическая симуляция (Rapier.js / Matter.js)
- Бот автоматически сражается на основе физики + правил
- **AI-комментатор**: LLM стримит комментарий в реальном времени через SSE ("Разрушительный удар лазером! Красный Барон теряет переднее колесо и начинает заваливаться!")
- Длительность: 5-20 секунд

**Плюсы**: визуально зрелищно, понятная механика, широкая аудитория
**Минусы**: сложная разработка физики, балансировка

#### Вариант B: AI-driven бои (уникальная механика)

**Фаза сборки:**
- Текстовое описание бота: внешность, оружие, стиль боя
- Числовые параметры: атака, защита, скорость, HP (пул очков для распределения)
- **Behavior rules** (ключевая механика): игрок задаёт правила поведения на естественном языке:
  - "Держись на расстоянии и стреляй ракетами"
  - "Если HP < 30%, включи щит и отступай"
  - "Атакуй слабейшего противника первым"
  - "Используй booster когда враг далеко"

**Фаза боя:**
- LLM получает описания обоих ботов + их behavior rules + текущее состояние
- Генерирует пошаговый нарратив боя через SSE
- Каждый ход: LLM решает исход на основе stats + rules + рандома
- Визуализация: анимированные спрайты/аватарки + текстовый лог боя
- Длительность: 30с-2мин (5-10 ходов)

**Плюсы**: уникальная механика (нет аналогов), глубокая кастомизация, контент бесконечен, проще разработка (не нужна физика)
**Минусы**: LLM-зависимость (стоимость, задержка), сложнее балансировка, менее визуально

#### Вариант C: Гибрид (рекомендуемый)

**Фаза сборки:**
- Визуальный конструктор (шасси + оружие + колёса + гаджет) — как в CATS
- **+ AI personality**: игрок описывает характер бота текстом → LLM генерирует avatar description, battle cry, personality traits
- **+ Behavior preset**: выбор из 5-6 стратегий (aggressive/defensive/balanced/sniper/berserker/tactician) с текстовым описанием
- Числовые параметры определяются компонентами (не произвольно)

**Фаза боя:**
- **Детерминированная симуляция** на основе stats + behavior preset + seeded RNG
- **Простая визуализация**: 2D спрайты с анимациями (атака, получение урона, использование гаджета)
- **AI-комментатор**: LLM стримит эпичный комментарий поверх визуализации
- **AI post-battle**: развёрнутый анализ ("Твой Blade не достал до противника из-за низкого шасси. Попробуй Stinger для большей дальности")
- Длительность: 10-30с

**Плюсы**: визуально + AI-уникальность, балансируемо (статы из компонентов), AI необязателен для core loop (можно играть без комментариев)
**Минусы**: средняя сложность разработки

### Рекомендация: **Вариант C (Гибрид)**
AI как enhancement, а не как core mechanic. Если LLM недоступен — бой всё равно работает. AI добавляет flavor и глубину.

### Core Loop

```
┌──────────────┐    ┌──────────────┐    ┌──────────────┐
│   СБОРКА     │───>│     БОЙ      │───>│   НАГРАДА    │
│  (30с-2мин)  │    │  (10-30с)    │    │  (мгновенно) │
│              │    │              │    │              │
│ Шасси        │    │ Физика/Stats │    │ Новые части  │
│ Оружие       │    │ AI-коммент.  │    │ Рейтинг      │
│ Колёса       │    │ Визуализация │    │ Опыт         │
│ Гаджет       │    │              │    │              │
│ Personality  │    │              │    │              │
└──────────────┘    └──────────────┘    └──────────────┘
       ↑                                       │
       └───────────────────────────────────────┘
```

---

## 5. Техническая архитектура

### Frontend

| Слой | Технология | Альтернатива |
|------|-----------|-------------|
| **Физика** | Rapier.js (WASM, детерминированная) | Planck.js (pure JS, Box2D-based) |
| **Рендеринг** | PixiJS + WebGL | Phaser 4 (когда стабилен) |
| **UI** | React + TypeScript + Tailwind | — |
| **Реалтайм** | WebSocket (бои) + SSE (AI комментарии) | — |

**Matter.js** — самый популярный (128K npm/week, 17.9K GitHub stars), простой API, но не гарантирует кросс-платформенную детерминированность.

**Rapier.js** — Rust→WASM, 3-10x быстрее pure JS, поддерживает детерминированную симуляцию (критично для async PvP replay). Рекомендуется для продакшена.

**PixiJS** — 3x легче Phaser (450KB vs 1.2MB), 2x быстрее для рендеринга. Идеален когда нужен максимальный контроль.

### Backend

| Слой | Технология |
|------|-----------|
| **API** | FastAPI (Python) — уже есть в проекте |
| **БД** | PostgreSQL (бот-конфиги, результаты, рейтинги) |
| **AI** | Существующий LLM провайдер стек (Groq/Together/OpenAI и т.д.) |
| **Рейтинг** | Glicko-2 (rating + deviation + volatility) |
| **Очередь** | Redis или in-memory для matchmaking |

### Архитектура async PvP (как в CATS)

```
Client                    Server                     DB
  │                         │                         │
  │── Save bot config ─────>│── Store config ────────>│
  │                         │                         │
  │── Request battle ──────>│── Select opponent ─────>│
  │                         │── Generate seed          │
  │                         │── Store result ────────>│
  │<── Bot configs + seed ──│                         │
  │                         │                         │
  │── Run simulation locally│                         │
  │── AI commentary (SSE) ─>│── LLM generates ──────>│
  │<── Commentary stream ───│                         │
  │                         │                         │
  │── Confirm result ──────>│── Update ratings ─────>│
```

**Ключевой принцип**: симуляция детерминированная (одинаковый результат при одинаковых configs + seed). Клиент показывает replay; сервер — authority.

### Matchmaking (Glicko-2)

- **Rating** (оценка скилла, старт 1500)
- **RD** (Rating Deviation — уверенность, уменьшается с играми, растёт при неактивности)
- **Volatility** (стабильность результатов)

Алгоритм:
1. Найти оппонентов в окне ±100 рейтинга
2. Расширять окно каждые 5 секунд (+50)
3. Для async PvP — матч против сохранённых конфигов (не нужно ждать онлайн)
4. Не повторять оппонентов в течение X минут

JS-библиотеки: `glicko2.ts`, `glicko2js`.

### Модели данных (основные)

```python
class Bot:
    id, user_id, name, avatar_url
    chassis_type, weapon_type, wheel_type, gadget_type
    # Статы (вычисляются из компонентов)
    hp, attack, defense, speed
    # AI-слой
    personality_text, battle_cry, behavior_preset
    # Рейтинг
    rating, rd, volatility
    wins, losses

class Battle:
    id, bot1_id, bot2_id, winner_id
    seed, replay_data (JSON)
    ai_commentary (text)
    rating_change_1, rating_change_2
    created_at

class BotPart:
    id, type (chassis/weapon/wheel/gadget)
    subtype, tier, stars
    stats (JSONB: hp_bonus, attack_bonus, etc.)
    user_id (owner)
```

---

## 6. Монетизация

### Модель: Cosmetics + Battle Pass + Rewarded Ads

| Источник | Описание | Доля |
|---------|---------|------|
| **Cosmetics** | Скины ботов, эффекты взрывов, арены, эмоции победы | 40% |
| **Battle Pass** | $8-12/сезон, бесплатный + premium трек | 30% |
| **Rewarded Ads** | 30с видео = бонус (ускорение, доп. слот, бесплатный spin) | 20% |
| **Premium AI** | LLM-анализ боя, AI-советы по сборке, уникальные AI-генерированные боты | 10% |

### Принципы (анти-P2W)
- **Никогда** не продавать gameplay-преимущества (более сильное оружие, лучшие статы)
- Matchmaking по рейтингу = честные бои
- Cosmetics = самовыражение (скины, эффекты, арены)
- Premium AI features = convenience, не advantage
- Battle Pass мотивирует ежедневные визиты

### Premium AI фичи (уникальное УТП)
- **AI Battle Analyst**: развёрнутый анализ проигрышей + рекомендации по улучшению
- **AI Bot Designer**: описываешь концепцию → LLM генерирует оптимальный билд
- **AI Narrator**: режиссёрский комментарий боя (без premium — простой лог событий)
- **Custom Taunts**: LLM генерирует уникальные фразы для бота по описанию

---

## 7. MVP план

### Фаза 1: Core (2-3 недели)

**Цель**: собрать бота, провести бой, увидеть результат.

- [ ] Система компонентов: 4 шасси, 6 оружий, 4 типа колёс, 3 гаджета
- [ ] Визуальный конструктор ботов (drag-drop или слот-система)
- [ ] Stat-based боевая система (HP, Attack, Defense, Speed + behavior preset)
- [ ] Простая визуализация боя (спрайты + анимации, 2D Canvas)
- [ ] Результат боя: детерминированный алгоритм на stats + behavior + seed
- [ ] БД: Bot, Battle, BotPart модели
- [ ] API: CRUD ботов, запрос боя, результат

### Фаза 2: Multiplayer + AI (2-3 недели)

- [ ] Async PvP: бой против сохранённых ботов других игроков
- [ ] Glicko-2 рейтинговая система
- [ ] Matchmaking по рейтингу
- [ ] AI-комментатор: LLM генерирует комментарий боя через SSE
- [ ] Лутбоксы с запчастями (после победы)
- [ ] Прогрессия: тиры запчастей (Common → Rare → Epic → Legendary)

### Фаза 3: Social + Polish (2-3 недели)

- [ ] Лидерборды (глобальный + по лигам)
- [ ] Лиги (Bronze → Silver → Gold → Platinum → Diamond)
- [ ] Профиль игрока (коллекция ботов, статистика, история боёв)
- [ ] AI personality для ботов (battle cry, taunts, persona)
- [ ] Replay: возможность пересмотреть бой
- [ ] Шаринг ботов (ссылка на бота)

### Фаза 4: Monetization + Scale (2-3 недели)

- [ ] Battle Pass система (бесплатный + premium треки)
- [ ] Cosmetics магазин (скины, эффекты)
- [ ] Rewarded Ads
- [ ] Premium AI фичи (анализ, советы, кастомные тaunts)
- [ ] Турниры (еженедельные)
- [ ] Физическая симуляция (замена stat-based на Rapier.js для визуального спектакля)

### Интеграция с текущим проектом

Игра может быть:
1. **Отдельный проект** — свой домен, свой фронтенд, но переиспользует backend-инфраструктуру (FastAPI, PostgreSQL, LLM провайдеры, email, auth)
2. **Модуль внутри SweetSin/GrimQuill** — как мини-игра для привлечения трафика и увеличения retention
3. **Standalone с shared auth** — OAuth / SSO с основным проектом

**Рекомендация**: отдельный проект с переиспользованием backend-паттернов и LLM-инфраструктуры.

---

## Ключевые выводы

1. **CATS доказала модель**: "собери → смотри бой" работает на массовую аудиторию (100M+ скачиваний). Ноль управления в бою — это фича, не баг.

2. **AI — уникальное конкурентное преимущество**: ни одна существующая игра не комбинирует builder-механику с LLM-нарративом. TextBattle близка, но без глубины сборки.

3. **Async PvP идеален для веба**: не нужно ждать оппонента, детерминированные replays, работает на любом устройстве.

4. **Stat-based MVP → Physics polish**: начать с простого алгоритма на статах (быстрая разработка), потом добавить физику для "wow-эффекта".

5. **AI costs manageable**: комментарий боя = ~200-500 токенов = ~$0.001 на бой (Groq/Together). Premium AI = маржинальный продукт.

6. **Рынок auto-battlers растёт**: $1.5B к 2030. Web-сегмент недоpredставлен — почти все крупные авто-баттлеры на PC/mobile.

---

## Источники

### CATS
- [CATS Official](https://www.catsthegame.com/)
- [CATS Wiki (Fandom)](https://catsthegame.fandom.com/wiki/Crash_Arena_Turbo_Stars_Wiki)
- [PocketGamer — Making of CATS](https://www.pocketgamer.biz/interview/66379/feline-fighters-the-making-of-zeptolabs-cats/)
- [GDC Vault — CATS Postmortem](https://www.gdcvault.com/play/1025495/-C-A-T-S)
- [PocketGamer — CATS Monetization](https://www.pocketgamer.biz/the-iap-inspector/65612/how-does-zeptolabs-cats-crash-arena-turbo-stars-monetise/)

### Аналоги
- [PCGamesN — Best Auto-Battlers 2026](https://www.pcgamesn.com/auto-chess-games-best-autobattlers)
- [iLogos — Auto-Battler Development Guide](https://ilogos.biz/auto-battler-game-development-guide/)
- [Gladiabots](https://gladiabots.com/)
- [Battlesnake](https://play.battlesnake.com/)
- [Super Auto Pets](https://teamwoodgames.com/)

### AI Battle Games
- [LLM Fighter (GitHub)](https://github.com/neutree-ai/llm-fighter)
- [TextBattle](https://play.google.com/store/apps/details?id=com.brickstream.textbattle)
- [Prompt Wars](https://promptwars.io/)
- [Tensor Trust](https://tensortrust.ai/)
- [Digital Red Queen (Sakana AI)](https://pub.sakana.ai/drq/)

### Технологии
- [Rapier.js](https://github.com/dimforge/rapier.js)
- [Matter.js](https://brm.io/matter-js/)
- [Planck.js](https://piqnt.com/planck.js/)
- [PixiJS](https://pixijs.com/)
- [Glicko-2 Algorithm](https://glicko.net/glicko/glicko2.pdf)
- [glicko2js](https://github.com/mmai/glicko2js)

### Open Source
- [Battle Box — Bot Battle Engine](https://github.com/FlyingDutchmanGames/battle_box)
- [AFK Gacha Game](https://github.com/Lambda-Forge/afk_gacha_game)
- [Robocode](https://robocode.sourceforge.io/)
- [Screeps](https://github.com/screeps/screeps)
